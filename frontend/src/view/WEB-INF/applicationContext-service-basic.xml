<?xml version="1.0" encoding="UTF-8"?>
<!--
	Application context definition for AGNITAS service layer.

	Only service layer classes here!
-->
<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/util
		http://www.springframework.org/schema/util/spring-util-2.5.xsd
		http://www.springframework.org/schema/aop
		http://www.springframework.org/schema/aop/spring-aop.xsd">

	<context:component-scan base-package="org.agnitas, com.agnitas">
		<context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
		<context:exclude-filter type="annotation" expression="org.springframework.web.bind.annotation.ControllerAdvice"/>
	</context:component-scan>

	<bean id="ConfigurationValidityCheck" class="com.agnitas.emm.core.ConfigurationValidityCheckImpl">
		<property name="dataSource" ref="dataSource" />
		<property name="configService" ref="ConfigService" />
		<property name="configTableDao" ref="ConfigTableDao" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="targetService" ref="targetService"/>
		<property name="layoutDao" ref="LayoutDao"/>
	</bean>

<!-- ============================================================================================================================== Access data -->
	<bean id="AccessDataService" class="com.agnitas.emm.core.mobile.service.impl.AccessDataServiceImpl">
		<property name="accessDataDao" ref="accessDataDao" />
	</bean>


<!-- ============================================================================================================================== Admin & preferences -->
	<bean id="AdminService" class="com.agnitas.emm.core.admin.service.impl.AdminServiceImpl">
		<property name="adminDao" ref="AdminDao" />
		<property name="companyDao" ref="CompanyDao"/>
		<property name="adminPreferencesDao" ref="AdminPreferencesDao"/>
		<property name="bulkActionValidationService" ref="bulkActionValidationService"/>
		<property name="adminGroupDao" ref="AdminGroupDao"/>
		<property name="configService" ref="ConfigService" />
        <property name="permissionFilter" ref="PermissionFilter"/>
        <property name="emmLayoutBaseDao" ref="EmmLayoutBaseDao"/>
        <property name="permissionService" ref="PermissionService"/>
        <property name="adminNotifier">
        	<bean class="com.agnitas.emm.core.admin.service.impl.AdminEmailNotifier">
        		<constructor-arg ref="JavaMailService" />
				<constructor-arg ref="ConfigService" />
			</bean>
        </property>
    </bean>
    
	<bean id="UserGroupService" class="com.agnitas.emm.core.usergroup.service.impl.UserGroupServiceImpl">
		<constructor-arg name="configService" ref="ConfigService" />
		<constructor-arg name="userGroupDao" ref="AdminGroupDao" />
		<constructor-arg name="companyService" ref="CompanyService" />
		<constructor-arg name="conversionService" ref="conversionService" />
		<constructor-arg name="permissionFilter" ref="PermissionFilter" />
		<constructor-arg name="permissionService" ref="PermissionService" />
    </bean>
    
    <bean id="SalutationService" class="com.agnitas.emm.core.salutation.service.impl.SalutationServiceImpl">
   		<constructor-arg name="titleDao" ref="TitleDao" />
    </bean>

	<bean id="adminChangesLogService" class="com.agnitas.emm.core.admin.service.impl.AdminChangesLogServiceImpl">
		<property name="adminService" ref="AdminService" />
	</bean>

	<bean id="AdminGroupService" class="com.agnitas.emm.core.admin.service.impl.AdminGroupServiceImpl">
		<property name="adminGroupDao" ref="AdminGroupDao" />
	</bean>

    <bean id="WebStorage" class="com.agnitas.service.impl.WebStorageImpl" scope="session" lazy-init="true">
        <aop:scoped-proxy/>
    </bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass" value="org.apache.commons.lang3.ClassUtils"/>
		<property name="targetMethod" value="getClass"/>
		<property name="arguments">
			<list>
				<value type="java.lang.String">com.agnitas.service.WebStorage</value>
				<value type="java.lang.Boolean">true</value>
			</list>
		</property>
	</bean>

<!-- ============================================================================================================================== RecipientsReport -->
	<bean id="RecipientsReportService" class="com.agnitas.emm.core.recipientsreport.service.impl.RecipientsReportServiceImpl">
		<property name="recipientsReportDao" ref="RecipientsReportDao" />
        <property name="mimeTypeService" ref="MimeTypeService"/>
        <property name="bulkFilesDownloadService" ref="bulkFilesDownloadServiceImpl"/>
    </bean>

<!-- ============================================================================================================================== Campaign -->
	<bean id="CampaignService" class="com.agnitas.emm.core.archive.service.impl.CampaignServiceImpl">
		<property name="campaignDao" ref="CampaignDao"/>
		<property name="bulkActionValidationService" ref="bulkActionValidationService"/>
	</bean>

<!-- ================================================================================ Auto optimization -->
	<bean id="optimizationCommonService" class="com.agnitas.mailing.autooptimization.service.impl.OptimizationCommonServiceImpl">
		<property name="maildropStatusDao" ref="MaildropStatusDao" />
		<property name="optimizationDao" ref="OptimizationDao" />
		<property name="mailingDao" ref="MailingDao" />
	</bean>

	<bean id="OptimizationStatService" class="com.agnitas.mailing.autooptimization.service.impl.OptimizationStatServiceImpl">
		<property name="statDao" ref="StatDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="birtCompanyDao" ref="BirtCompanyDao" />
	</bean>

	<bean id="optimizationService" class="com.agnitas.mailing.autooptimization.service.impl.OptimizationServiceImpl">
		<constructor-arg name="optimizationDao" ref="OptimizationDao" />
		<constructor-arg name="targetDao" ref="TargetDao" />
		<constructor-arg name="mailingDao" ref="MailingDao" />
		<constructor-arg name="optimizationCommonService" ref="optimizationCommonService" />
		<constructor-arg name="optimizationStatService" ref="OptimizationStatService" />
		<constructor-arg name="mailingParameterService" ref="MailingParameterService" />
		<constructor-arg name="copyMailingService" ref="CopyMailingService" />
	</bean>

	<bean id="optimizationScheduleService" class="com.agnitas.mailing.autooptimization.service.impl.OptimizationScheduleServiceImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="optimizationCommonService" ref="optimizationCommonService" />
		<property name="targetDao" ref="TargetDao" />
		<property name="maildropService" ref="MaildropService" />
	</bean>

<!-- ============================================================================================================================== Binding -->
	<bean id="BindingService" class="com.agnitas.emm.core.binding.service.impl.BindingServiceImpl" >
		<property name="bindingEntryDao" ref="BindingEntryDao" />
		<property name="mailinglistDao" ref="MailinglistDao" />
		<property name="recipientDao" ref="RecipientDao" />
		<property name="bindingEntryFactory" ref="BindingEntryFactory" />
		<property name="mailingDao" ref="MailingDao" />
        <property name="bindingModelValidator" ref="bindingModelValidator"/>
    </bean>

<!-- ============================================================================================================================== Blacklist -->
	<bean id="BlacklistService" class="org.agnitas.emm.core.blacklist.service.impl.BlacklistServiceImpl">
		<property name="blacklistDao" ref="BlacklistDao" />
		<property name="bindingService" ref="BindingService" />
		<property name="conversionService" ref="conversionService" />
		<property name="recipientDao" ref="RecipientDao" />
        <property name="blacklistModelValidator" ref="blacklistModelValidator" />
    </bean>

<!-- ============================================================================================================================== Calendar -->
	<bean id="calendarReminderService" class="com.agnitas.emm.core.reminder.service.impl.ReminderServiceImpl">
		<property name="reminderDao" ref="CalendarCommentDao" />
		<property name="javaMailService" ref="JavaMailService" />
	</bean>

<!-- ============================================================================================================================== Companies -->
    <bean id="CompanyTokenService" class="com.agnitas.emm.core.company.service.impl.CompanyTokenServiceImpl">
    	<property name="companyTokenDao" ref="CompanyTokenDao" />
    	<property name="companyService" ref="CompanyService" />
    	<property name="configService" ref="ConfigService" />
    	<property name="tokenGenerator" ref="DefaultTokenGenerator" />
    </bean>
    
    <bean id="CompanyAccessCheck" class="org.agnitas.emm.core.velocity.emmapi.CompanyAccessCheckImpl" >
    	<property name="configService" ref="ConfigService" />
    	<property name="javaMailService" ref="JavaMailService" />
    	<property name="companyHierarchyCache" ref="CompanyHierarchyCache" />
    </bean>

<!-- ============================================================================================================================== Component -->
	<bean id="componentService" class="com.agnitas.emm.core.components.service.impl.ComponentServiceImpl" > <!-- Maybe this can be merged with "mailingComponentService"? -->
		<property name="mailingComponentDao" ref="MailingComponentDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="formComponentDao" ref="FormComponentDao" />
		<property name="conversionService" ref="conversionService"/>
		<property name="modelValidator" ref="componentModelValidator"/>
		<property name="mailingComponentFactory" ref="MailingComponentFactory"/>
		<property name="configService" ref="ConfigService" />
		<property name="imageDimensionService" ref="imageDimensionServiceImpl" />
    </bean>

<!-- ============================================================================================================================== Configuration -->
	<bean id="ConfigService" class="org.agnitas.emm.core.commons.util.ConfigService" init-method="getInstance">
		<property name="permissionService" ref="PermissionService" />
		<property name="licenseDao" ref="LicenseDao" />
		<property name="configTableDao" ref="ConfigTableDao" />
		<property name="companyInfoDao" ref="CompanyInfoDao" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="adminDao" ref="AdminDao" />
		<property name="webserviceUserDao" ref="WebserviceUserDao" />
		<property name="dataEncryptor" ref="DataEncryptor" />
		<property name="serverMessageDao" ref="ServerMessageDao" />
		<property name="recipientFieldService" ref="RecipientFieldService" />
		<property name="javaMailService" ref="JavaMailService" />
	</bean>

<!-- ============================================================================================================================== CSV -->
	<bean id="CSVService" class="com.agnitas.service.impl.CSVServiceImpl">
		<property name="adminGroupDao" ref="AdminGroupDao" />
	</bean>

	<bean id="ClientService" class="com.agnitas.emm.core.mobile.service.impl.ClientServiceImpl">
		<property name="clientDao" ref="ClientDao" />
	</bean>
	
	<!-- ============================================================================================================================== CompanySettings -->
	<bean id="CompanySettingsDtoFactory" class="com.agnitas.emm.core.company.factory.impl.CompanySettingsDtoFactoryImpl">
		<property name="configService" ref="ConfigService" />
	</bean>

<!-- ============================================================================================================================== Dynamic tag -->
	<bean id="AgnTagService" class="com.agnitas.service.impl.AgnTagServiceImpl">
		<property name="dynamicTagFactory" ref="DynamicTagFactory" />
		<property name="tagDetailsFactory" ref="TagDetailsFactory" />
		<property name="agnTagResolverFactory" ref="AgnTagResolverFactory" />
		<property name="tagDao" ref="TagDao" />
		<property name="agnTagAttributeResolverRegistry" ref="AgnTagAttributeResolverRegistry" />
	</bean>

	<bean id="AgnTagResolverFactory" class="com.agnitas.service.impl.AgnTagResolverFactoryImpl">
		<property name="recipientFactory" ref="RecipientFactory" />
		<property name="extensibleUidService" ref="ExtensibleUIDService" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="titleDao" ref="TitleDao" />
		<property name="tagDao" ref="TagDao" />
		<property name="configService" ref="ConfigService" />
		<property name="recipientService" ref="recipientService"/>
		<property name="companyTokenService" ref="CompanyTokenService" />
	</bean>

	<bean id="AgnDynTagGroupResolverFactory" class="com.agnitas.service.impl.AgnDynTagGroupResolverFactoryImpl">
		<property name="dynamicTagDao" ref="DynamicTagDao" />
	</bean>

<!-- ============================================================================================================================== Dynamic tag names -->
	<bean id="dynamicTagNameService" class="org.agnitas.emm.core.dynname.service.impl.DynamicTagNameServiceImpl" />

<!-- ============================================================================================================================== ECS (Heatmap) -->
	<bean id="EmbeddedClickStatService" class="com.agnitas.ecs.backend.service.impl.EmbeddedClickStatServiceImpl">
		<property name="embeddedClickStatDao" ref="EmbeddedClickStatDao" />
		<property name="previewFactory" ref="PreviewFactory" />
		<property name="configService" ref="ConfigService" />
		<property name="ecsService" ref="EcsService" />
	</bean>

<!-- ============================================================================================================================== EMM actions -->
	<bean id="EmmActionService" class="com.agnitas.emm.core.action.service.impl.EmmActionServiceImpl">
		<constructor-arg ref="ColumnInfoService" />
		<property name="emmActionDao" ref="EmmActionDao" />
		<property name="emmActionOperationDao" ref="EmmActionOperationDao" />
		<property name="emmActionOperationService" ref="EmmActionOperationService" />
		<property name="mailingDao" ref="MailingDao" />
        <property name="conversionService" ref="conversionService"/>
        <property name="actionImporter" ref="ActionImporter"/>
        <property name="changesCollector" ref="emmActionChangesCollector"/>
        <property name="actionExporter" ref="ActionExporter"/>
		<property name="userformService" ref="userformService"/>
		<property name="mailingService" ref="MailingService"/>
		<property name="bulkActionValidationService" ref="bulkActionValidationService"/>
    </bean>

<!-- ============================================================================================================================== EMM action operations -->
	<bean id="EmmActionOperationService" class="com.agnitas.emm.core.action.service.impl.EmmActionOperationServiceImpl">
		<!-- Key value equals to discriminator value in action operation entities-->
		<property name="executors">
			<list>
				<ref bean="actionOperationExecuteScript" />
				<ref bean="actionOperationUpdateCustomer" />
				<ref bean="actionOperationGetCustomer" />
				<ref bean="actionOperationActivateDoubleOptIn" />
				<ref bean="actionOperationSubscribeCustomer" />
				<ref bean="actionOperationUnsubscribeCustomer" />
				<ref bean="actionOperationSendMailing" />
				<ref bean="actionOperationServiceMail" />
				<ref bean="actionOperationGetArchiveList" />
				<ref bean="actionOperationGetArchiveMailing" />
				<ref bean="actionOperationContentView" />
				<ref bean="actionOperationIdentifyCustomer" />
				<ref bean="actionOperationSendLastNewsletter" />
			</list>
		</property>
	</bean>

	<bean id="actionOperationExecuteScript" class="com.agnitas.emm.core.action.service.impl.ActionOperationExecuteScriptImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="beanLookupFactory" ref="beanLookupFactory" />
		<property name="javaMailService" ref="JavaMailService" />
		<property name="companyAccessCheck" ref="CompanyAccessCheck" />
		<property name="datasourceDescriptionDao" ref="DatasourceDescriptionDao" />
		<property name="sendActionbasedMailingService" ref="SendActionbasedMailingService" />
		<property name="subscriberLimitCheck" ref="SubscriberLimitCheck" />
	</bean>

	<bean id="actionOperationUpdateCustomer" class="com.agnitas.emm.core.action.service.impl.ActionOperationUpdateCustomerImpl">
		<property name="recipientDao" ref="RecipientDao" />
	</bean>

	<bean id="actionOperationGetCustomer" class="com.agnitas.emm.core.action.service.impl.ActionOperationGetCustomerImpl" >
		<property name="beanLookupFactory" ref="beanLookupFactory" />
		<property name="recipientService" ref="recipientService"/>
		<property name="configService" ref="ConfigService" />
		<property name="recipientFieldService" ref="RecipientFieldService" />
	</bean>

	<bean id="actionOperationActivateDoubleOptIn" class="com.agnitas.emm.core.action.service.impl.ActionOperationActivateDoubleOptInImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="bindingEntryDao" ref="BindingEntryDao" />
	</bean>

	<bean id="actionOperationUnsubscribeCustomer" class="com.agnitas.emm.core.action.service.impl.ActionOperationUnsubscribeCustomerImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="recipientService" ref="recipientService"/>
	</bean>

	<bean id="actionOperationSendMailing" class="com.agnitas.emm.core.action.service.impl.ActionOperationSendMailingImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="sendActionbasedMailingService" ref="SendActionbasedMailingService" />
	</bean>

	<bean id="actionOperationServiceMail" class="com.agnitas.emm.core.action.service.impl.ActionOperationServiceMailImpl">
		<property name="javaMailService" ref="JavaMailService" />
		<property name="beanLookupFactory" ref="beanLookupFactory" />
		<property name="blacklistService" ref="BlacklistService" />
		<property name="recipientService" ref="recipientService"/>
		<property name="configService" ref="ConfigService" />
		<property name="recipientFieldService" ref="RecipientFieldService" />
	</bean>

	<bean id="MailingArchiveService" class="org.agnitas.emm.core.mailing.service.impl.MailingArchiveServiceImpl">
		<constructor-arg ref="MailingDao" />
	</bean>

	<bean id="actionOperationGetArchiveList" class="com.agnitas.emm.core.action.service.impl.ActionOperationGetArchiveListImpl">
		<constructor-arg ref="MailingArchiveService" />
		<constructor-arg ref="ExtensibleUIDService" />
		<constructor-arg ref="CompanyDao" />
		<constructor-arg ref="ConfigService" />
		<constructor-arg ref="MailingPreviewService" />
	</bean>

	<bean id="actionOperationGetArchiveMailing" class="com.agnitas.emm.core.action.service.impl.ActionOperationGetArchiveMailingImpl">
		<property name="previewFactory" ref="PreviewFactory" />
		<property name="mailingDao" ref="MailingDao" />
	</bean>

	<bean id="actionOperationContentView" class="com.agnitas.emm.core.action.service.impl.ActionOperationContentViewImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="mailingPreviewService" ref="MailingPreviewService" />
	</bean>

	<bean id="actionOperationIdentifyCustomer" class="com.agnitas.emm.core.action.service.impl.ActionOperationIdentifyCustomerImpl">
		<property name="uidService" ref="ExtensibleUIDService" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="beanLookupFactory" ref="beanLookupFactory" />
		<property name="configService" ref="ConfigService" />
		<property name="recipientService" ref="recipientService"/>
		<property name="recipientFieldService" ref="RecipientFieldService" />
	</bean>

	<bean id="actionOperationSendLastNewsletter" class="com.agnitas.emm.core.action.service.impl.ActionOperationSendLastNewsletterImpl">
		<constructor-arg ref="MailingDao" />
		<constructor-arg ref="MaildropService" />
	</bean>
	
<!-- ============================================================================================================================== Host authentication -->
	<bean id="HostAuthenticationSecurityCodeGenerator" class="com.agnitas.emm.core.logon.service.DefaultHostAuthenticationSecurityCodeGenerator">
		<property name="lengthOfCode" value="8" />
		<property name="randomNumberGenerator" ref="RandomNumberGenerator" />
		<property name="alphabet" value="0123456789ABCDEF" />
	</bean>

	<bean id="ClientHostIdService" class="com.agnitas.emm.core.logon.service.impl.ClientHostIdServiceImpl">
		<property name="configService" ref="ConfigService" />
	</bean>

	<bean id="HostAuthenticationService" class="com.agnitas.emm.core.logon.service.impl.HostAuthenticationServiceImpl">
		<property name="configService" ref="ConfigService" />
		<property name="securityCodeGenerator" ref="HostAuthenticationSecurityCodeGenerator" />
		<property name="hostAuthenticationDao" ref="HostAuthenticationDao" />
		<property name="javaMailService" ref="JavaMailService" />
		<property name="adminService" ref="AdminService" />
		<property name="previewFactory" ref="PreviewFactory" />
	</bean>

<!-- ============================================================================================================================== Session Binding -->
	<bean id="SessionBindingService" class="com.agnitas.emm.security.sessionbinding.web.service.SessionBindingServiceImpl" />

<!-- ============================================================================================================================== Import -->

	<bean id="ProfileImportReporter" class="com.agnitas.emm.core.imports.reporter.ProfileImportReporter">
		<property name="recipientsReportService" ref="RecipientsReportService" />
		<property name="javaMailService" ref="JavaMailService" />
		<property name="mailinglistDao" ref="MailinglistDao" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="configService" ref="ConfigService" />
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
        <property name="dataSourceService" ref="dataSourceService"/>
		<property name="importQuotaCheckService" ref="ImportQuotaService" />
    </bean>

	<bean id="MailingImportService" class="com.agnitas.emm.core.imports.service.impl.MailingImportServiceImpl">
		<constructor-arg name="mailingImporter" ref="MailingImporter"/>
	</bean>

	<bean id="ImportModeHandlerFactory" class="com.agnitas.service.ImportModeHandlerFactory" />

	<bean name="RecipientExportReporter" class="com.agnitas.emm.core.export.reporter.RecipientExportReporter">
		<constructor-arg name="recipientsReportService" ref="RecipientsReportService"/>
		<constructor-arg name="javaMailService" ref="JavaMailService" />
		<constructor-arg name="companyDao" ref="CompanyDao" />
		<constructor-arg name="configService" ref="ConfigService" />
		<constructor-arg name="mailinglistService" ref="MailinglistService" />
		<constructor-arg name="targetDao" ref="TargetDao" />
	</bean>

<!-- ============================================================================================================================== Job queue -->
	<bean id="JobQueueService" class="com.agnitas.service.JobQueueService">
		<property name="configService" ref="ConfigService" />
		<property name="jobQueueDao" ref="JobQueueDao" />
		<property name="configTableDao" ref="ConfigTableDao" />
		<property name="birtReportDao" ref="BirtReportDao" />
		<property name="beanLookupFactory" ref="beanLookupFactory" />
		<property name="daoLookupFactory" ref="daoLookupFactory" />
		<property name="serviceLookupFactory" ref="serviceLookupFactory" />
		<property name="mailNotificationService" ref="MailNotificationService" />
	</bean>

<!-- ============================================================================================================================== Login tracking -->
	<bean id="GuiLoginTrackService" class="org.agnitas.emm.core.logintracking.service.impl.LoginTrackServiceImpl">
		<property name="loginTrackDao" ref="GuiLoginTrackDao" />
        
        <property name="loginTrackSettingsDao">
        	<bean class="org.agnitas.emm.core.logintracking.dao.GuiLoginTrackSettingsDaoImpl">
	        	<property name="configService" ref="ConfigService" />
	        </bean>
        </property>
    </bean>

	<bean id="UserSelfService" class="com.agnitas.emm.core.user.service.impl.UserSelfServiceImpl">
		<property name="loginTrackService" ref="GuiLoginTrackService" />
	</bean>
 
<!-- ============================================================================================================================== Mailing -->
	<bean id="SendActionbasedMailingService" class="com.agnitas.emm.core.mailing.service.impl.SendActionbasedMailingServiceImpl">
		<property name="mailgunFactory" ref="MailgunFactory" />
		<property name="maildropStatusDao" ref="MaildropStatusDao" />
	</bean>

	<bean id="MailingLightService" class="com.agnitas.service.impl.MailingLightServiceImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="maildropService" ref="MaildropService" />
	</bean>

	<bean id="MailingService" class="com.agnitas.emm.core.mailing.service.impl.MailingServiceImpl">
		<property name="adminService" ref="AdminService" />
		<property name="configService" ref="ConfigService" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="javaMailService" ref="JavaMailService" />
		<property name="mailinglistDao" ref="MailinglistDao" />
		<property name="targetDao" ref="TargetDao" />
		<property name="dynamicTagDao" ref="DynamicTagDao" />
		<property name="mailingComponentDao" ref="MailingComponentDao" />
		<property name="maildropService" ref="MaildropService" />
		<property name="mailingFactory" ref="MailingFactory" />
		<property name="mailingComponentFactory" ref="MailingComponentFactory" />
		<property name="mediatypeFactory" ref="MediatypeFactory" />
		<property name="mailingBaseService" ref="MailingBaseService" />
		<property name="mailingContentService" ref="MailingContentService" />
		<property name="mailingModelValidator" ref="mailingModelValidator" />
        <property name="objectUsageService" ref="ObjectUsageService"/>
        <property name="userActivityLogService" ref="UserActivityLogService"/>
		<property name="copyMailingService" ref="CopyMailingService"/>
        <property name="mediatypesDao" ref="MediatypesDao"/>
        <property name="bulkActionValidationService" ref="bulkActionValidationService"/>
        <!-- Self injection for transactions -->
        <property name="selfReference" ref="MailingService"/>
	</bean>

<!-- ============================================================================================================================== Mailing delivery lock service -->
	<bean id="MailingDeliveryBlockingService" class="com.agnitas.emm.core.mailing.service.impl.MailingDeliveryBlockingServiceImpl">
		<constructor-arg name="mailingDeliveryBlockingDao" ref="MailingDeliveryBlockingDao"/>
		<constructor-arg name="maildropService" ref="MaildropService"/>
	</bean>

<!-- ============================================================================================================================== Mailing component -->
	<bean id="mailingComponentService" class="com.agnitas.emm.core.components.service.impl.MailingComponentsServiceImpl">
		<property name="mimeTypeService" ref="MimeTypeService" />
		<property name="mailingDao" ref="MailingDao" />
        <property name="mailingComponentDao" ref="MailingComponentDao" />
		<property name="mailingComponentFactory" ref="MailingComponentFactory" />
		<property name="configService" ref="ConfigService" />
		<property name="componentValidationService" ref="ComponentValidationService" />
        <property name="conversionService" ref="conversionService"/>
		<property name="bulkFilesDownloadService" ref="bulkFilesDownloadServiceImpl"/>
    </bean>

<!-- ============================================================================================================================== Mailing Stop -->
	<bean id="MailingStopService" class="com.agnitas.emm.core.mailing.service.impl.MailingStopServiceImpl">
		<property name="serverPrioService" ref="ServerPrioService" />
		<property name="mailingService" ref="MailingService" />
		<property name="maildropService" ref="MaildropService" />
		<property name="copyMailingService" ref="CopyMailingService" />
		<property name="companyInfoDao" ref="CompanyInfoDao" />
		<property name="eqlFacade" ref="EqlFacade" />
		<property name="companyService" ref="CompanyService" />
	</bean>

<!-- ============================================================================================================================== Mailing parameter -->
	<bean id="MailingParameterService" class="com.agnitas.emm.core.mailing.service.impl.MailingParameterServiceImpl">
		<property name="mailingParameterDao" ref="MailingParameterDao" />
		<property name="mailingParameterLogService" ref="mailingParameterLogService"/>
	</bean>

<!-- ============================================================================================================================== Mailinglists -->
	<bean id="MailinglistService" class="com.agnitas.emm.core.mailinglist.service.impl.MailinglistServiceImpl">
		<property name="mailinglistDao" ref="MailinglistDao" />
		<property name="mailinglistApprovalDao" ref="MailinglistApprovalDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="bindingEntryDao" ref="BindingEntryDao" />
		<property name="bulkActionValidationService" ref="bulkActionValidationService" />
		<property name="birtReportDao" ref="BirtReportDao" />
        <property name="recipientDao" ref="RecipientDao"/>
        <property name="targetDao" ref="TargetDao"/>
    </bean>
    
	<bean id="MailinglistApprovalService" class="com.agnitas.emm.core.mailinglist.service.impl.MailinglistApprovalServiceImpl">
		<constructor-arg name="mailinglistApprovalDao" ref="MailinglistApprovalDao" />
		<constructor-arg name="adminService" ref="AdminService" />
		<constructor-arg name="mailinglistDao" ref="MailinglistDao" />
	</bean>

<!-- ============================================================================================================================== Mailing preview -->
	<bean id="MailingPreviewService" class="com.agnitas.mailing.preview.service.MailingPreviewServiceImpl">
		<property name="previewFactory" ref="PreviewFactory" />
	</bean>

	<bean id="MailingWebPreviewService" class="com.agnitas.emm.core.preview.service.impl.MailingWebPreviewServiceImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="mediatypeFactory" ref="MediatypeFactory" />
		<property name="previewFactory" ref="PreviewFactory" />
		<property name="tagCheckFactory" ref="TAGCheckFactory" />
		<property name="previewService" ref="MailingPreviewService" />
	</bean>

<!-- ============================================================================================================================== Mailloop -->
	<bean id="MailloopService" class="com.agnitas.emm.core.mailloop.service.impl.MailloopServiceImpl">
		<property name="mailloopDao" ref="MailloopDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="sendActionbasedMailingService" ref="SendActionbasedMailingService" />
	</bean>

<!-- ============================================================================================================================== Profile fields -->
	<bean id="ColumnInfoService" class="com.agnitas.service.impl.ColumnInfoServiceImpl">
		<property name="profileFieldDao" ref="ProfileFieldDao" />
	</bean>

<!-- ============================================================================================================================== Send mailing -->
	<bean id="mailingReportScheduleService" class="com.agnitas.emm.core.components.service.impl.MailingReportScheduleServiceImpl">
		<constructor-arg ref="BirtReportFactory"/>
		<constructor-arg ref="BirtReportService"/>
	</bean>

	<bean id="mailingSizeCalculationService" class="com.agnitas.emm.core.mailing.service.impl.MailingSizeCalculationServiceImpl">
		<constructor-arg ref="mailingComponentService"/>
		<constructor-arg ref="AgnTagService"/>
		<constructor-arg ref="LinkService"/>
	</bean>

<!-- ============================================================================================================================== Recipient -->
	<bean id="SubscriberLimitCheck" class="org.agnitas.emm.core.recipient.service.impl.SubscriberLimitCheckImpl">
		<constructor-arg ref="ConfigService" />
		<constructor-arg ref="RecipientDao" />
	</bean>
	
	<bean id="recipientService" class="org.agnitas.emm.core.recipient.service.impl.RecipientServiceImpl">
		<property name="recipientDao" ref="RecipientDao" />
		<property name="uidService" ref="ExtensibleUIDService" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="recipientFactory" ref="RecipientFactory" />
		<property name="configService" ref="ConfigService" />
		<property name="sendActionbasedMailingService" ref="SendActionbasedMailingService" />
		<property name="targetService" ref="targetService"/>
		<property name="profileFieldDao" ref="ProfileFieldDao"/>
        <property name="profileFieldValidationService" ref="ProfileFieldValidationService"/>
        <property name="columnInfoService" ref="ColumnInfoService" />
		<property name="recipientQueryBuilder" ref="RecipientQueryBuilder"/>
		<property name="recipientWorkerFactory" ref="RecipientWorkerFactory"/>
		<property name="adminService" ref="AdminService"/>
		<property name="bindingEntryDao" ref="BindingEntryDao"/>
		<property name="bindingEntryFactory" ref="BindingEntryFactory"/>
		<property name="conversionService" ref="conversionService"/>
		<property name="mailinglistDao" ref="MailinglistDao"/>
		<property name="subscriberLimitCheck" ref="SubscriberLimitCheck" />
		<property name="mailinglistApprovalService" ref="MailinglistApprovalService" />
		<property name="bulkActionValidationService" ref="bulkActionValidationService" />
        <property name="recipientModelValidator" ref="recipientModelValidator"/>
		<property name="targetDao" ref="TargetDao" />
		<property name="eqlFacade" ref="EqlFacade" />
    </bean>

<!-- ============================================================================================================================== Report -->
	<bean id="BirtReportService" class="com.agnitas.emm.core.birtreport.service.impl.BirtReportServiceImpl">
		<property name="birtReportDao" ref="BirtReportDao" />
		<property name="campaignDao" ref="CampaignDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="dataSource" ref="dataSource" />
		<property name="conversionService" ref="conversionService" />
		<property name="birtStatisticsService" ref="BirtStatisticsService" />
		<property name="birtReportFileService" ref="BirtReportFileService"/>
		<property name="configService" ref="ConfigService" />
	</bean>

<!-- ============================================================================================================================== Server Prio -->
	<bean id="ServerPrioService" class="com.agnitas.emm.core.serverprio.server.impl.ServerPrioServiceImpl">
		<property name="serverPrioDao" ref="ServerPrioDao" />
	</bean>

<!-- ============================================================================================================================== Service mails -->
	<bean id="SendServiceMailService" class="com.agnitas.emm.core.servicemail.impl.SendServiceMailServiceImpl">
		<property name="emmActionService" ref="EmmActionService" />
	</bean>

<!-- ============================================================================================================================== Statistic -->
	<bean id="BirtStatisticsService" class="com.agnitas.emm.core.birtstatistics.service.impl.BirtStatisticsServiceImpl" >
		<property name="configService" ref="ConfigService" />
        <property name="adminService" ref="AdminService" />
		<property name="birtReportFileService" ref="BirtReportFileService"/>
	</bean>

	<bean id="BirtReportFileService" class="com.agnitas.emm.core.birtreport.service.impl.BirtReportFileServiceImpl" >
		<constructor-arg name="mailingService" ref="MailingService" />
	</bean>

<!-- ============================================================================================================================== Statistics job -->
	<bean id="MailingSummaryStatisticJobService" class="com.agnitas.emm.core.stat.service.impl.MailingSummaryStatisticJobServiceImpl" >
		<property name="mailingDao" ref="MailingDao" />
		<property name="lightTargetDao" ref="LightTargetDao" />
		<property name="mailingStatJobDao" ref="MailingStatJobDao" />
		<property name="mailingStatTgtGrpDao" ref="MailingStatTgtGrpDao" />
		<property name="configService" ref="ConfigService" />
		<property name="workerExecutorService" ref="WorkerExecutorService" />
	</bean>

<!-- ============================================================================================================================== Tags -->
	<bean id="TagSyntaxChecker" class="com.agnitas.preview.TagSyntaxChecker">
		<constructor-arg name="tagDao" ref="TagDao" />
	</bean>

<!-- ============================================================================================================================== Target groups -->
	<bean id="TargetGroupDependencyService" class="com.agnitas.emm.core.target.service.impl.TargetGroupDependencyServiceImpl">
		<constructor-arg name="exportProfilesCollector" ref="targetDependentExportProfilesCollector"/>
		<constructor-arg name="maildropsCollector" ref="targetDependentMaildropsCollector"/>
		<constructor-arg name="mailingComponentsCollector" ref="targetDependentMailingComponentsCollector"/>
		<constructor-arg name="dynTagCollector" ref="targetDependentDynTagsCollector"/>
		<constructor-arg name="mailingsCollector" ref="targetDependentMailingsCollector"/>
		<constructor-arg name="exportPredefService" ref="ExportPredefService"/>
		<constructor-arg name="mailingService" ref="MailingService"/>
		<constructor-arg name="componentDao" ref="MailingComponentDao"/>
		<constructor-arg name="dynamicTagContentService" ref="dynamicTagContentService"/>
	</bean>

	<bean id="targetService" class="com.agnitas.emm.core.target.service.impl.TargetServiceImpl">
		<property name="targetDao" ref="TargetDao" />
		<property name="mailingComponentDao" ref="MailingComponentDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="recipientDao" ref="RecipientDao" />
		<property name="eqlFacade" ref="EqlFacade" />
		<property name="profileFieldService" ref="ProfileFieldService" />
		<property name="beanShellInterpreterFactory" ref="BeanShellInterpreterFactory" />
		<property name="targetComplexityEvaluator" ref="TargetComplexityEvaluator"/>
		<property name="referencedItemsService" ref="TargetGroupsReferencedItemsService" />
		<property name="bulkActionValidationService" ref="bulkActionValidationService" />
		<property name="targetFactory" ref="TargetFactory"/>
		<property name="queryBuilderToEqlConverter" ref="QueryBuilderToEqlConverter"/>
		<property name="eqlValidatorService" ref="eqlValidatorService"/>
		<property name="eqlReferenceItemsExtractor" ref="eqlReferenceItemsExtractor"/>
		<property name="targetGroupDependencyService" ref="TargetGroupDependencyService"/>
		<property name="mailingContentService" ref="MailingContentService" />
	</bean>

	<bean id="eqlValidatorService" class="com.agnitas.emm.core.target.eql.EqlValidatorServiceImpl">
		<property name="eqlFacade" ref="EqlFacade"/>
	</bean>
	
	<bean id="TargetGroupsReferencedItemsService" class="com.agnitas.emm.core.target.service.impl.ReferencedItemsServiceImpl">
		<property name="referencedItemsDao" ref="TargetGroupsReferencedItemsDao" />
	</bean>

	<bean name="TargetComplexityEvaluator" class="com.agnitas.emm.core.target.complexity.service.impl.TargetComplexityEvaluatorImpl">
		<property name="eqlParser" ref="EqlParser"/>
		<property name="targetComplexityAnalyzerMap" ref="TargetComplexityAnalyzerMap"/>
	</bean>

	<bean id="TargetCopyService" class="com.agnitas.emm.core.target.service.impl.TargetCopyServiceImpl" />

	<bean name="TargetGroupEditorContentSynchronizer" class="com.agnitas.emm.core.target.web.util.EditorContentSynchronizer">
		<property name="eqlToQueryBuilderConverter" ref="EqlToQueryBuilderConverter" />
		<property name="queryBuilderToEqlConverter" ref="QueryBuilderToEqlConverter" />
		<property name="queryBuilderFilterListBuilder" ref="TargetGroupQueryBuilderFilterListBuilder" />
		<property name="targetService" ref="targetService"/>
	</bean>

	<bean name="TargetGroupQueryBuilderFilterListBuilder" class="com.agnitas.emm.core.target.eql.emm.querybuilder.QueryBuilderFilterListBuilder">
		<property name="queryBuilderConfiguration" ref="QueryBuilderConfiguration"/>
		<property name="profileFieldService" ref="ProfileFieldService"/>
	</bean>
<!-- ============================================================================================================================== Token generators -->
	<bean id="DefaultTokenGenerator" class="com.agnitas.emm.core.commons.tokengen.RandomTokenGenerator">
		<constructor-arg>
			<bean class="java.security.SecureRandom" />
		</constructor-arg>
	</bean>

<!-- ============================================================================================================================== Trackable links -->
	<bean id="TrackableLinkService" class="com.agnitas.emm.core.trackablelinks.service.impl.TrackableLinkServiceImpl">
		<property name="trackableLinkDao" ref="TrackableLinkDao" />
		<property name="mailingService" ref="MailingService" />
		<property name="configService" ref="ConfigService" />
	</bean>

	<bean id="FormTrackableLinkService" class="com.agnitas.emm.core.trackablelinks.service.impl.FormTrackableLinkServiceImpl">
		<property name="trackableLinkDao" ref="FormTrackableLinkDao"/>
		<property name="linkService" ref="LinkService"/>
        <property name="conversionService" ref="conversionService"/>
    </bean>

<!-- ============================================================================================================================== UID -->
	<bean id="ExtensibleUIDService" class="org.agnitas.emm.core.commons.uid.impl.ExtensibleUIDServiceImpl">
		<property name="parser" ref="ExtensibleUIDParser" />
		<property name="stringBuilder" ref="ExtensibleUIDStringBuilder" />
	</bean>

<!-- ============================================================================================================================== User activity log -->
	<bean id="UserActivityLogService" class="com.agnitas.emm.core.useractivitylog.service.DbUserActivityLogServiceImpl">
		<constructor-arg  ref="UserActivityLogDao" />
		<constructor-arg  ref="RestfulUserActivityLogDao" />
		<constructor-arg  ref="SoapUserActivityLogDao" />
	</bean>

<!-- ============================================================================================================================== Velocity -->
	<bean id="ScriptHelperService" class="com.agnitas.emm.core.scripthelper.service.ScriptHelperService">
		<property name="mailingDao" ref="MailingDao" />
		<property name="previewFactory" ref="PreviewFactory" />
	</bean>

<!-- ============================================================================================================================== Workflow -->
	<bean id="workflowStartStopReminderService" class="com.agnitas.emm.core.reminder.service.impl.ReminderServiceImpl">
		<property name="reminderDao" ref="workflowStartStopReminderDao" />
		<property name="javaMailService" ref="JavaMailService" />
	</bean>

	<bean id="WorkflowStatisticsService" class="com.agnitas.emm.core.workflow.service.WorkflowStatisticsService">
		<property name="mailingService" ref="MailingService" />
		<property name="workflowService" ref="WorkflowService" />
		<property name="optimizationService" ref="optimizationService" />
		<property name="birtStatisticsService" ref="BirtStatisticsService"/>
	</bean>

	<bean id="WorkflowDataParser" class="com.agnitas.emm.core.workflow.service.WorkflowDataParser" />

	<bean id="WorkflowService" class="com.agnitas.emm.core.workflow.service.impl.WorkflowServiceImpl">
		<property name="workflowDao" ref="workflowDao" />
		<property name="mailingDao" ref="MailingDao" />
		<property name="targetDao" ref="TargetDao" />
		<property name="targetService" ref="targetService" />
		<property name="adminService" ref="AdminService" />
		<property name="userFormDao" ref="UserFormDao" />
		<property name="birtCompanyDao" ref="BirtCompanyDao" />
		<property name="reactionDao" ref="WorkflowReactionDao" />
		<property name="workflowValidationService" ref="WorkflowValidationService" />
		<property name="optimizationService" ref="optimizationService" />
		<property name="optimizationCommonService" ref="optimizationCommonService" />
		<property name="sendActionbasedMailingService" ref="SendActionbasedMailingService" />
		<property name="profileFieldDao" ref="ProfileFieldDao" />
		<property name="workflowDataParser" ref="WorkflowDataParser" />
		<property name="workflowStartStopReminderDao" ref="workflowStartStopReminderDao" />
		<property name="reminderService" ref="workflowStartStopReminderService" />
		<property name="reminderDao" ref="workflowStartStopReminderDao" />
		<property name="campaignDao" ref="CampaignDao"/>
		<property name="mediatypesDao" ref="MediatypesDao"/>
		<property name="mailingService" ref="MailingService"/>
		<property name="bulkActionValidationService" ref="bulkActionValidationService"/>
		<property name="workflowActivationService" ref="WorkflowActivationService"/>
		<property name="maildropStatusDao" ref="MaildropStatusDao"/>
		<property name="mailingDeliveryBlockingService" ref="MailingDeliveryBlockingService"/>

		<!-- Self injection -->
		<property name="selfReference" ref="WorkflowService" />
    </bean>

<!-- ============================================================================================================================== ??? -->

	<bean id="filterMultipartResolver"
		  class="org.springframework.web.multipart.support.StandardServletMultipartResolver">
	</bean>

<!-- ============================================================================================================================== Device -->
	<bean id="DeviceService" class="com.agnitas.emm.core.mobile.service.impl.DeviceServiceImpl"/>

<!-- ============================================================================================================================== User Form Execution -->
	<bean id="UserFormExecutionService" class="com.agnitas.emm.core.userform.service.impl.UserFormExecutionServiceImpl">
		<property name="configService" ref="ConfigService" />
		<property name="extensibleUIDService" ref="ExtensibleUIDService" />
		<property name="deviceService" ref="DeviceService" />
		<property name="recipientDao" ref="RecipientDao" />
		<property name="userFormDao" ref="UserFormDao" />
		<property name="clientService" ref="ClientService" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="mailingContentTypeCache" ref="MailingContentTypeCache" />
        <property name="trackableLinkDao" ref="FormTrackableLinkDao"/>
		<property name="recipientFactory" ref="RecipientFactory" />
		<property name="recipientService" ref="recipientService"/>
    </bean>
	
<!-- ============================================================================================================================== Hash tags -->
	<bean id="HashTagRegistry" class="com.agnitas.emm.core.hashtag.service.HashTagRegistryImpl">
		<property name="hashTags">
			<list>
				<ref bean="UnencodedProfileFieldHashTag" />
				<ref bean="ProfileFieldEncryptionHashTag" />
				<ref bean="HexProfileFieldEncodingHashTag" />
				<ref bean="Rot47ProfileFieldHashTag" />
				<ref bean="Md5ProfileFieldHashTag" />
				<ref bean="DateHashTag" />
				<ref bean="AlterHashTag" />
				<ref bean="AgeHashTag" />
				<ref bean="Base64urlProfileFieldEncodingHashTag" />
			</list>
		</property>
	</bean>
	
	<bean id="HashTagEvaluationService" class="com.agnitas.emm.core.hashtag.service.HashTagEvaluationServiceImpl">
		<property name="hashTagRegistry" ref="HashTagRegistry" />
		<property name="fallbackHashTag" ref="ProfileFieldHashTag" />
	</bean>

<!-- ============================================================================================================================== Misc. -->

	<bean id="linkcheckService" class="com.agnitas.service.LinkcheckService" >
		<property name="configService" ref="ConfigService" />
	</bean>

	<bean id="MimeTypeService" class="com.agnitas.service.MimeTypeService" />

	<bean id="MailNotificationService" class="com.agnitas.service.MailNotificationService" >
		<property name="mailNotificationBufferDao" ref="MailNotificationBufferDao" />
		<property name="javaMailService" ref="JavaMailService" />
	</bean>

	<bean id="dataSourceService" class="com.agnitas.service.impl.DataSourceServiceImpl" >
		<property name="datasourceDescriptionDao" ref="DatasourceDescriptionDao" />
        <property name="webserviceUserDao" ref="WebserviceUserDao"/>
    </bean>

	<bean id="DataEncryptor" class="com.agnitas.util.DataEncryptor">
		<property name="configService" ref="ConfigService" />
	</bean>

	<bean id="RecipientProfileHistoryService" class="com.agnitas.emm.core.recipient.service.impl.RecipientProfileHistoryServiceImpl">
		<property name="recipientProfileHistoryDao" ref="RecipientProfileHistoryDao" />
		<property name="configService" ref="ConfigService" />
		<property name="profileFieldDao" ref="ProfileFieldDao" />
		<property name="recipientFieldService" ref="RecipientFieldService" />
	</bean>

	<bean id="JavaMailService" class="com.agnitas.emm.core.JavaMailServiceImpl">
		<property name="configService" ref="ConfigService" />
		<property name="dkimDao" ref="DkimDao" />
	</bean>

	<bean id="LinkService" class="com.agnitas.emm.core.linkcheck.service.LinkServiceImpl">
		<property name="mailingDao" ref="MailingDao" />
		<property name="mailingParameterDao" ref="MailingParameterDao" />
		<property name="configService" ref="ConfigService" />
		<property name="agnTagService" ref="AgnTagService" />
		<property name="companyDao" ref="CompanyDao" />
		<property name="hashTagEvaluationService" ref="HashTagEvaluationService" />
        <property name="workflowService" ref="WorkflowService"/>
        <property name="targetService" ref="targetService"/>
    </bean>

	<bean id="CopyMailingService" class="org.agnitas.emm.core.mailing.service.impl.CopyMailingServiceImpl">
		<property name="mailingExporter" ref="MailingExporter" />
		<property name="mailingImporter" ref="MailingImporter" />
	</bean>

	<bean id="ImportProfileService" class="com.agnitas.service.impl.ImportProfileServiceImpl">
		<property name="importProfileDao" ref="ImportProfileDao" />
        <property name="recipientService" ref="recipientService"/>
        <property name="recipientFieldService" ref="RecipientFieldService" />
        <property name="bulkActionValidationService" ref="bulkActionValidationService"/>
    </bean>
	
	<bean id="UserFormExporter" class="com.agnitas.service.impl.UserFormExporterImpl" />
	
	<bean id="UserFormImporter" class="com.agnitas.service.impl.UserFormImporterImpl" />
	
	<bean id="ActionExporter" class="com.agnitas.service.impl.ActionExporter" />
	
	<bean id="ActionImporter" class="com.agnitas.service.impl.ActionImporter" />
	
	<bean id="ProfileFieldService" class="com.agnitas.emm.core.profilefields.service.impl.ProfileFieldServiceImpl">
		<property name="profileFieldDao" ref="ProfileFieldDao" />
		<property name="columnInfoService" ref="ColumnInfoService"/>
 	</bean>

	<bean id="PatternScheduleConfig" class="org.agnitas.emm.core.schedule.PatternScheduleConfig">
		<constructor-arg name="weekDays">
			<util:map>
				<!--Empty value to schedule daily run-->
				<entry key="0" value="" />
				<entry key="1" value="Su" />
				<entry key="2" value="Mo" />
				<entry key="3" value="Tu" />
				<entry key="4" value="We" />
				<entry key="5" value="Th" />
				<entry key="6" value="Fr" />
				<entry key="7" value="Sa" />
			</util:map>
		</constructor-arg>
		<constructor-arg name="monthlyPatterns">
			<util:map>
				<entry key="1" value="M01" />
				<entry key="15" value="M15" />
				<entry key="99" value="M99" />
			</util:map>
		</constructor-arg>
		<constructor-arg name="fromFormat" value="HH:mm" />
		<constructor-arg name="toFormat" value="HHmm" />
	</bean>

	<bean id="PatternScheduleBuilderService" class="org.agnitas.emm.core.schedule.PatternScheduleBuilderService">
		<constructor-arg name="config" ref="PatternScheduleConfig"/>
	</bean>

	<bean id="IntervalPatternScheduleBuilderService" class="org.agnitas.emm.core.schedule.IntervalPatternScheduleBuilderService">
		<constructor-arg name="config" ref="PatternScheduleConfig"/>
		<constructor-arg name="patternScheduleBuilderService" ref="PatternScheduleBuilderService"/>
	</bean>

	<bean id="MailClickTrackingService" class="com.agnitas.emm.core.mailtracking.service.ClickTrackingServiceImpl">
		<property name="trackableLinkDao" ref="TrackableLinkDao" />
		<property name="configService" ref="ConfigService" />
		<property name="mailingContentTypeCache" ref="MailingContentTypeCache" />
		<property name="recipientFactory" ref="RecipientFactory" />
		<property name="recipientService" ref="recipientService"/>
		<property name="onLinkClickedHandlers">
			<list>
				<ref bean="WebhookOnLinkClickedHandler" />
			</list>
		</property>
	</bean>

	<bean id="MailOpenTrackingService" class="com.agnitas.emm.core.mailtracking.service.OpenTrackingServiceImpl">
		<property name="onepixelDao" ref="OnepixelDao" />
		<property name="configService" ref="ConfigService" />
		<property name="mailingContentTypeCache" ref="MailingContentTypeCache" />
		<property name="onMailingOpenedHandlers">
			<list>
				<ref bean="WebhookOnMailOpenedHandler" />
			</list>
		</property>
	</bean>

	<bean id="FullviewService" class="com.agnitas.emm.core.mailing.service.impl.FullviewServiceImpl">
		<property name="companyService" ref="CompanyService" />
		<property name="userFormService" ref="userformService" />
		<property name="mailingService" ref="MailingService" />
		<property name="configService" ref="ConfigService" />
		<property name="recipientService" ref="recipientService" />
		<property name="extensibleUidService" ref="ExtensibleUIDService" />
		<property name="companyTokenService" ref="CompanyTokenService" />
	</bean>

	<bean id="ImportModeAddHandler" class="com.agnitas.util.importvalues.ImportModeAddHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="ImportModeAddAndUpdateHandler" class="com.agnitas.util.importvalues.ImportModeAddAndUpdateHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="ImportModeUpdateHandler" class="com.agnitas.util.importvalues.ImportModeUpdateHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
	</bean>
	
	<bean id="ImportModeAddAndUpdateForcedHandler" class="com.agnitas.util.importvalues.ImportModeAddAndUpdateForcedHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="ImportModeUnsubscribeHandler" class="com.agnitas.util.importvalues.ImportModeUnsubscribeHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
	</bean>
	
	<bean id="ImportModeReactivateSuspendedHandler" class="com.agnitas.util.importvalues.ImportModeReactivateSuspendedHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
	</bean>
	
	<bean id="ImportModeMarkAsBounceHandler" class="com.agnitas.util.importvalues.ImportModeMarkAsBounceHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
	</bean>
	
	<bean id="ImportModeBounceReactivateHandler" class="com.agnitas.util.importvalues.ImportModeBounceReactivateHandler">
		<property name="importRecipientsDao" ref="ImportRecipientsDao" />
	</bean>
	
	<bean id="ImportModeBlacklistHandler" class="com.agnitas.util.importvalues.ImportModeBlacklistHandler" />
	
	<bean id="ImportModeBlacklistExclusiveHandler" class="com.agnitas.util.importvalues.ImportModeBlacklistExclusiveHandler" />


	<bean id="MimeTypeWhitelistService" class="com.agnitas.emm.core.mimetypes.service.MimeTypeWhitelistServiceImpl">
		<property name="mimeTypeWhitelistPatternDao" ref="MimeTypeWhitelistPatternDao" />
	</bean>
	
	<bean id="SessionHijackingPreventionService" class="com.agnitas.emm.core.sessionhijacking.service.SessionHijackingPreventionServiceImpl">
		<property name="sessionHijackingPreventionDao" ref="SessionHijackingPreventionDataDao" />
	</bean>

	<bean id="dashboardService" class="com.agnitas.emm.core.dashboard.service.impl.DashboardServiceImpl">
		<property name="mailingDao" ref="MailingDao"/>
		<property name="mailingSummaryDataSetFactory" ref="MailingSummaryDataSetFactory"/>
        <property name="workflowService" ref="WorkflowService"/>
        <property name="recipientsReportService" ref="RecipientsReportService"/>
	</bean>

	<bean id="deliveryService" class="com.agnitas.emm.core.delivery.service.impl.DeliveryServiceImpl">
		<property name="deliveryDao" ref="deliveryDao"/>
		<property name="mailingBaseService" ref="MailingBaseService" />
	</bean>
	
		
	<!-- ============================================================================================================================== Mobile phone whitelist -->
	<bean id="MobilephoneNumberWhitelist" class="com.agnitas.emm.mobilephone.service.MobilephoneNumberWhitelistImpl">
		<property name="mobilephoneNumberWhitelistDao" ref="MobilephoneNumberWhitelistDao" />
	</bean>
    
    <bean id="PermissionService" class="com.agnitas.emm.core.permission.service.PermissionServiceImpl">
    	<property name="permissionDao" ref="PermissionDao" />
    </bean>
    
    <bean id="WebservicePermissionService" class="com.agnitas.emm.wsmanager.service.impl.WebservicePermissionServiceImpl">
    	<property name="webservicePermissionDao" ref="WebservicePermissionDao" />
    </bean>
    
    <bean id="WebservicePermissionGroupService" class="com.agnitas.emm.wsmanager.service.impl.WebservicePermissionGroupServiceImpl">
    	<property name="webservicePermissionGroupDao" ref="WebservicePermissionGroupDao" />
    </bean>

	<!-- ============================================================================================================================== Start-Up jobs -->
	<bean id="StartupJobExecutionService" class="com.agnitas.startuplistener.service.StartupJobExecutionServiceImpl">
		<property name="startupJobEntryDao" ref="StartupJobEntryDao" />
		<property name="configService" ref="ConfigService" />
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<!--  -->
	
	<bean id="LandingpageService" class="com.agnitas.emm.landingpage.service.LandingpageServiceImpl">
		<property name="landingpageDao" ref="LandingpageDao" />
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="ImageCache" class="com.agnitas.web.ImageCache">
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="CdnCache" class="com.agnitas.web.CdnCache">
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="RestfulServiceHandler_login" class="com.agnitas.emm.restful.LoginRestfulServiceHandler">
		<property name="restfulUserActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="RestfulServiceHandler_recipient" class="com.agnitas.emm.restful.recipient.RecipientRestfulServiceHandler">
		<constructor-arg ref="RestfulUserActivityLogDao"/>
		<constructor-arg ref="RecipientDao" />
		<constructor-arg ref="BindingEntryDao" />
		<constructor-arg ref="RecipientFieldService" />
		<constructor-arg ref="MailinglistDao" />
		<constructor-arg ref="ProfileImportWorkerFactory" />
		<constructor-arg ref="DatasourceDescriptionDao" />
		<constructor-arg ref="FullviewService"/>
		<constructor-arg ref="ConfigService" />
		<constructor-arg ref="SubscriberLimitCheck" />
	</bean>
	
	<bean id="RestfulServiceHandler_mailinglist" class="com.agnitas.emm.restful.mailinglist.MailinglistRestfulServiceHandler">
		<constructor-arg ref="RestfulUserActivityLogDao" />
		<constructor-arg ref="MailinglistService" />
		<constructor-arg ref="recipientService" />
		<constructor-arg ref="RecipientFieldService" />
	</bean>
	
	<bean id="RestfulServiceHandler_blacklist" class="com.agnitas.emm.restful.blocklist.BlacklistRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="blacklistDao" ref="BlacklistDao" />
	</bean>
	
	<bean id="RestfulServiceHandler_blocklist" class="com.agnitas.emm.restful.blocklist.BlocklistRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="blacklistDao" ref="BlacklistDao" />
	</bean>
	
	<bean id="RestfulServiceHandler_mailing" class="com.agnitas.emm.restful.mailing.MailingRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="mailingDao" ref="MailingDao" />
		<property name="mailinglistDao" ref="MailinglistDao" />
		<property name="mailingExporter" ref="MailingExporter" />
		<property name="mailingImporter" ref="MailingImporter" />
		<property name="copyMailingService" ref="CopyMailingService" />
		<property name="thumbnailService" ref="ThumbnailService" />
		<property name="mailingBaseService" ref="MailingBaseService"/>
        <property name="companyTokenService" ref="CompanyTokenService" />
        <property name="maildropService" ref="MaildropService" />
	</bean>
	
	<bean id="RestfulServiceHandler_component" class="com.agnitas.emm.restful.component.ComponentRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="mailingDao" ref="MailingDao" />
		<property name="mailingComponentDao" ref="MailingComponentDao" />
		<property name="targetDao" ref="TargetDao" />
		<property name="companyDao" ref="CompanyDao"/>
		<property name="thumbnailService" ref="ThumbnailService" />
        <property name="companyTokenService" ref="CompanyTokenService" />
	</bean>
	
	<bean id="RestfulServiceHandler_binding" class="com.agnitas.emm.restful.binding.BindingRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="recipientDao" ref="RecipientDao" />
		<property name="bindingEntryDao" ref="BindingEntryDao" />
		<property name="mailinglistDao" ref="MailinglistDao" />
		<property name="emmActionService" ref="EmmActionService" />
		<property name="configService" ref="ConfigService" />
	</bean>
	
	<bean id="RestfulServiceHandler_actionExecute" class="com.agnitas.emm.restful.action.ActionExecuteRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="emmActionService" ref="EmmActionService" />
	</bean>
	
	<bean id="RestfulServiceHandler_content" class="com.agnitas.emm.restful.content.ContentRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="mailingDao" ref="MailingDao" />
		<property name="dynamicTagDao" ref="DynamicTagDao" />
		<property name="targetDao" ref="TargetDao" />
		<property name="thumbnailService" ref="ThumbnailService" />
		<property name="mailingContentService" ref="MailingContentService" />
		<property name="maildropService" ref="MaildropService" />
	</bean>
	
	<bean id="RestfulServiceHandler_statistics" class="com.agnitas.emm.restful.statistics.StatisticsRestfulServiceHandler">
		<constructor-arg ref="RestfulUserActivityLogDao"/>
		<constructor-arg ref="CompanyDao"/>
		<constructor-arg ref="MailingDao"/>
		<constructor-arg ref="MailingSummaryDataSetFactory"/>
		<constructor-arg ref="MailinglistDao"/>
	</bean>
	
	<bean id="RestfulServiceHandler_workflow" class="com.agnitas.emm.restful.workflow.WorkflowRestfulServiceHandler">
		<constructor-arg ref="ConfigService"/>
		<constructor-arg ref="RestfulUserActivityLogDao"/>
		<constructor-arg ref="WorkflowService"/>
		<constructor-arg ref="WorkflowActivationService"/>
	</bean>
	
	<bean id="RestfulQuotaService" class="com.agnitas.emm.util.quota.tokenbucket.Bucket4jQuotaService">
		<property name="bucketManager">
			<bean class="com.agnitas.emm.restful.util.quota.LocalBucketManager">
				<property name="configService" ref="ConfigService" />
				
				<property name="restfulQuotaDao">
					<bean class="com.agnitas.emm.restful.util.quota.dao.RestfulQuotaDaoImpl" parent="_BaseDao" />
				</property>
			</bean>
		</property>
		
		<property name="apiInvocationCosts">
			<bean class="com.agnitas.emm.restful.util.quota.RestfulApiInvocationCostsCache">
				<constructor-arg>
					<bean class="com.agnitas.emm.restful.util.quota.dao.RestfulApiInvocationCostsDaoImpl" parent="_BaseDao" />
				</constructor-arg>
				<constructor-arg ref="ConfigService" />
			</bean>
		</property>
	</bean>
	
	<bean id="ObjectUsageService" class="com.agnitas.emm.core.objectusage.service.impl.ObjectUsageServiceImpl">
		<property name="targetGroupReferencedItemsService" ref="TargetGroupsReferencedItemsService" />
		<property name="profileFieldService" ref="ProfileFieldService" />
        <property name="workflowService" ref="WorkflowService"/>
        <property name="emmActionService" ref="EmmActionService"/>
	</bean>
	
	<bean id="MailingPropertiesRules" class="com.agnitas.emm.core.mailing.service.impl.MailingPropertiesRulesImpl">
		<property name="maildropService" ref="MaildropService" />
		<property name="mailingDao" ref="MailingDao" />
	</bean>

	<bean id="WysiwygService" class="com.agnitas.emm.core.wysiwyg.service.impl.WysiwygServiceImpl">
		<property name="mailingComponentsService" ref="mailingComponentService" />
	</bean>
	
	<bean id="ThumbnailService" class="com.agnitas.emm.core.thumbnails.service.ThumbnailServiceImpl">
		<property name="mailingComponentDao" ref="MailingComponentDao" />
	</bean>
	
	<bean id="RestfulServiceHandler_profilefield" class="com.agnitas.emm.restful.profilefield.ProfilefieldRestfulServiceHandler">
		<constructor-arg ref="ConfigService" />
		<constructor-arg ref="AdminService" />
		<constructor-arg ref="RecipientFieldService" />
		<constructor-arg ref="RestfulUserActivityLogDao" />
	</bean>
	
	<bean id="RestfulServiceHandler_form" class="com.agnitas.emm.restful.form.FormRestfulServiceHandler">
		<property name="userActivityLogDao" ref="RestfulUserActivityLogDao"/>
		<property name="userFormDao" ref="UserFormDao" />
		<property name="UserFormExporter" ref="UserFormExporter" />
        <property name="companyTokenService" ref="CompanyTokenService" />
	</bean>
	
	<bean id="RecipientFieldsCache" class="com.agnitas.emm.core.service.impl.RecipientFieldsCacheImpl">
		<constructor-arg ref="ConfigService" />
	</bean>
	
	<bean id="RecipientFieldService" class="com.agnitas.emm.core.service.impl.RecipientFieldServiceImpl">
		<property name="configService" ref="ConfigService" />
		<property name="recipientFieldsCache" ref="RecipientFieldsCache"/>
		<property name="bulkActionValidationService" ref="bulkActionValidationService"/>
		<property name="recipientFieldDao" ref="RecipientFieldDao"/>
		<property name="profileFieldDao" ref="ProfileFieldDao"/>
		<property name="recipientProfileHistoryService" ref="RecipientProfileHistoryService"/>
	</bean>
	
	<!-- ============================================================================================================================== HTTP response headers -->
	
	<bean id="HttpResponseHeaderApplier" class="com.agnitas.emm.responseheaders.web.HttpResponseHeaderApplierImpl">
		<constructor-arg>
			<bean class="com.agnitas.emm.responseheaders.service.HttpResponseHeaderServiceImpl">
				<constructor-arg>
					<bean class="com.agnitas.emm.responseheaders.dao.HeaderConfigCache">
						<constructor-arg>
							<bean class="com.agnitas.emm.responseheaders.dao.DatabaseHeaderConfigSource" parent="_BaseDao" />
						</constructor-arg>
						<constructor-arg value="60000" />
					</bean>
				</constructor-arg>
			</bean>
		</constructor-arg>
		<constructor-arg ref="ConfigService" />
	</bean>
	
	<bean id="ImportQuotaService" class="com.agnitas.emm.core.importquota.service.ImportQuotaServiceImpl">
		<constructor-arg ref="ImportQuotaDao" />
		<constructor-arg ref="ConfigService" />
	</bean>

	<bean id="ServerStatusService" class="com.agnitas.emm.core.serverstatus.service.impl.ServerStatusServiceImpl">
		<constructor-arg ref="ServerStatusDao" />
		<constructor-arg ref="ConfigService" />
		<constructor-arg ref="JobQueueService" />
		<constructor-arg ref="JavaMailService" />
	</bean>

<!-- ============================================================================================================================== MediaType -->
	<bean id="MediaTypesService" class="com.agnitas.emm.core.mediatypes.service.impl.MediaTypesServiceImpl">
		<constructor-arg ref="MediatypesDao"/>
	</bean>

	<bean id="mailingRecipientExportWorkerFactory" class="com.agnitas.service.MailingRecipientExportWorkerFactoryImpl">
		<property name="mailingRecipientsService" ref="MailingRecipientsServiceImpl"/>
	</bean>


	<!-- ============================================================================================================================== Webhooks -->
	<bean id="WebhookProfileFieldsService" class="com.agnitas.emm.core.webhooks.profilefields.service.WebhookProfileFieldsServiceImpl">
		<property name="webhookProfileFieldDao" ref="WebhookProfileFieldDao" />
	</bean>

	<bean id="WebhookProfileFieldContentService" class="com.agnitas.emm.core.webhooks.profilefields.service.WebhookProfileFieldContentServiceImpl">
		<property name="webhookProfileFieldDao" ref="WebhookProfileFieldDao" />
		<property name="recipientService" ref="recipientService" />
	</bean>

	<bean id="WebhookOnLinkClickedHandler" class="com.agnitas.emm.core.webhooks.event.LinkClickedWebhookHandler">
		<property name="webhookMessageEnqueueService" ref="WebhookMessageEnqueueService" />
	</bean>

	<bean id="WebhookOnMailOpenedHandler" class="com.agnitas.emm.core.webhooks.event.MailOpenedWebhookHandler">
		<property name="webhookMessageEnqueueService" ref="WebhookMessageEnqueueService" />
	</bean>

	<bean id="WebhookRegistrationService" class="com.agnitas.emm.core.webhooks.registry.service.WebhookRegistrationServiceImpl">
		<property name="webhookRegistrationDao" ref="WebhookRegistrationDao" />
	</bean>

	<bean id="WebhookMessageEnqueueService" class="com.agnitas.emm.core.webhooks.messages.service.WebhookMessageEnqueueServiceImpl">
		<constructor-arg ref="ConfigService" />
		<constructor-arg ref="WebhookRegistrationService" />
		<constructor-arg ref="WebhookMessageQueueDao" />
		<constructor-arg ref="WebhookProfileFieldContentService" />
	</bean>

	<bean id="WebhookMessageDequeueService" class="com.agnitas.emm.core.webhooks.messages.service.WebhookMessageDequeueServiceImpl">
		<property name="webhookMessageQueueDao" ref="WebhookMessageQueueDao" />
		<property name="configService" ref="ConfigService" />
	</bean>

	<bean id="WebhookMessageSender" class="com.agnitas.emm.core.webhooks.sender.WebhookMessageSenderImpl">
		<property name="webhookRegistrationService" ref="WebhookRegistrationService" />
		<property name="webhookMessageDequeueService" ref="WebhookMessageDequeueService" />
		<property name="webhookHttpClientFactory">
			<bean class="com.agnitas.emm.core.webhooks.sender.WebhookHttpClientFactoryImpl">
				<property name="configService" ref="ConfigService" />
			</bean>
		</property>
		<property name="configService" ref="ConfigService" />
	</bean>

	<bean id="WebhookBackendDataService" class="com.agnitas.emm.core.webhooks.messages.service.WebhookBackendDataServiceImpl">
		<property name="webhookBackendDataDao" ref="WebhookBackendDataDao" />
	</bean>

	<bean id="_MailingDeliveryMessageGenerator" abstract="true">
		<property name="webhookBackendDataService" ref="WebhookBackendDataService" />
		<property name="webhookMessageEnqueueService" ref="WebhookMessageEnqueueService" />
		<property name="webhookProcessTimestampDao" ref="WebhookBackendDataProcessTimestampDao" />
		<property name="configService" ref="ConfigService" />
	</bean>

	<bean id="WebhookBackendDataMessageGeneratorService" class="com.agnitas.emm.core.webhooks.messages.service.WebhookBackendDataMessageGeneratorServiceImpl">
		<property name="webhookBackendDataMessageGenerators">
			<list>
				<!-- Message generator for "mailing delivered" -->
				<bean class="com.agnitas.emm.core.webhooks.messages.service.MailDeliveryMessageGeneratorImpl" parent="_MailingDeliveryMessageGenerator" />

				<bean class="com.agnitas.emm.core.webhooks.messages.service.TestMailDeliveryMessageGeneratorImpl" parent="_MailingDeliveryMessageGenerator" />

				<!-- Message generator for "hardbounce" -->
				<bean class="com.agnitas.emm.core.webhooks.messages.service.HardbounceMessageGeneratorImpl" parent="_MailingDeliveryMessageGenerator" />

				<!-- Message generator for "mailing delivery complete" -->
				<bean class="com.agnitas.emm.core.webhooks.messages.service.MailingDeliveryCompleteWebhookBackendDataMessageGenerator" parent="_MailingDeliveryMessageGenerator" />

				<!-- Message generator for "profile field changed" -->
				<bean class="com.agnitas.emm.core.webhooks.messages.service.ProfileFieldChangedMessageGeneratorImpl" parent="_MailingDeliveryMessageGenerator" />
			</list>
		</property>
	</bean>

	<bean id="WebhookSettingsService" class="com.agnitas.emm.core.webhooks.settings.service.WebhookSettingsServiceImpl">
		<property name="webhookRegistrationService" ref="WebhookRegistrationService" />
		<property name="webhookProfileFieldsService" ref="WebhookProfileFieldsService" />
	</bean>

</beans>
